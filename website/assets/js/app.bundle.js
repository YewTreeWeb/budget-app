(window.webpackJsonp=window.webpackJsonp||[]).push([["app"],{0:function(e,t,n){e.exports=n("kFay")},1:function(e,t){},E4hX:function(e,t,n){(function(e,t){for(var n,o=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],a=c.length,s=window.console=window.console||{};a--;)s[n=c[a]]||(s[n]=o);window.addEventListener("keydown",(function e(t){9===t.keyCode&&(document.body.classList.add("user-is-tabbing"),window.removeEventListener("keydown",e))})),document.querySelector("html").setAttribute("data-browser",e.name);var i=document.querySelector("body");t({xlarge:["1281px","1680px"],large:["981px","1280px"],medium:["737px","980px"],small:["481px","736px"],xsmall:[null,"480px"]}),e.mobile?i.classList.add("is-mobile"):(t.on(">medium",(function(){i.classList.remove("is-mobile"),i.classList.add("is-desktop")})),t.on("<=medium",(function(){i.classList.remove("is-desktop"),i.classList.add("is-mobile")}))),"localhost"===window.location.hostname&&console.log("localhost detected!")}).call(this,n("txRt"),n("a6Qp"))},SEKM:function(e,t,n){"use strict";n.r(t);var o=n("lwsE"),c=n.n(o),a=n("W8MJ"),s=n.n(a),i=n("xVb/"),l=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=Math.abs(e),a=(c=c.toFixed(2)).split("."),s=a[0],i=a[1];i=Number(i)>0?".".concat(i):"",s.length>3&&(s="".concat(s.substr(0,s.length-3),",").concat(s.substr(s.length-3,3)));var l=n?'<span class="currency">&pound;</span>':"";return"".concat(o?"exp"===t?'<span class="sign">&#45;</span> ':'<span class="sign">&#43;</span> ':"").concat(l).concat(s).concat(i)},u=function(){function e(t,n,o){c()(this,e),this.inputType=t,this.inputDesc=n,this.inputVal=o}return s()(e,[{key:"getInput",value:function(){return{type:this.inputType.value,description:this.inputDesc.value,value:Number(this.inputVal.value)}}},{key:"render",value:function(e,t){var n,o="exp"===t?"expenses":"income",c=document.querySelector(".".concat(o,"__list"));n="\n    <li class='".concat(o,"__item' id='").concat(t,"-").concat(e.id,"'>\n      <div class='item-desc'><p>").concat(e.desc,"</p></div>\n      <div class=\"items\">\n        <div class='items__value'><p>").concat(l(e.val,t,!0,!1),"</p></div>\n    "),"exp"===t&&(n+='<div class="items__percent"><p>0&#37;</p></div>'),n+='\n        <button class=\'btn btn--clear items__del\'>\n          <svg id="delete" class="icon" width="20" height="20" aria-hidden="true">\n            <use xlink:href="/assets/images/icons.svg#icon-delete"></use>\n          </svg>\n        </button>\n      </div>\n    </li>\n    ',c.innerHTML+=n}},{key:"getBudget",value:function(e){return{budget:e.budget,totalInc:e.totals.inc,totalExp:e.totals.exp,percent:e.percent}}},{key:"displayBudget",value:function(e){var t=e.budget>0?"inc":"exp",n="exp"===t?"expenses":"income",o=document.querySelector(".budget__value"),c=document.querySelector(".budget__income .budget__amount"),a=document.querySelector(".budget__expenses .budget__amount");o.innerHTML=l(e.budget,t,!0),c.innerHTML=l(e.totalInc,"inc"),a.innerHTML=l(e.totalExp,"exp"),console.log("The ".concat(n," is/are ").concat(e.budget)),console.log(c,a)}},{key:"displayPercentage",value:function(e){var t=document.querySelector(".percentage");e>0?(t.classList.add("show"),t.innerHTML="".concat(e,"&#37;")):t.classList.remove("show"),console.log(t)}},{key:"updateBudget",value:function(){var e=i.default.calculateBudget(),t=this.getBudget(e);console.log(t),this.displayBudget(t),this.displayPercentage(t.percent)}},{key:"displayPercentages",value:function(e){!function(e,t){for(var n=0;n<e.length;n++)t(e[n],n)}(document.querySelectorAll(".items__percent"),(function(t,n){e[n]>0?(t.classList.add("show"),t.innerHTML="".concat(e[n],"&#37;")):(t.classList.remove("show"),t.innerHTML="0&#37;")}))}},{key:"updatePercentages",value:function(){i.default.calculatePercentages();var e=i.default.getPercentages();this.displayPercentages(e)}},{key:"displayDate",value:function(){var e=document.querySelector(".budget__date"),t=new Date;e.textContent="".concat(["January","February","March","April","May","June","July","August","Sepetember","October","November","December"][t.getMonth()]," ").concat(t.getFullYear())}},{key:"changeType",value:function(){var e=this.inputType,t=document.querySelector("#check"),n=[e,this.inputDesc,this.inputVal,t];console.log(n),e.addEventListener("change",(function(t){var o=Array.from(e.options);console.log(t),console.log(e.attributes,e.options,e.options.selectedIndex,o,o[1]),n.forEach((function(e){e.classList.toggle("exp")})),1===e.options.selectedIndex?(o[0].removeAttribute("selected","selected"),o[1].setAttribute("selected","selected")):(o[1].removeAttribute("selected","selected"),o[0].setAttribute("selected","selected"))}))}},{key:"deleteItem",value:function(){var e=this;document.querySelector(".income-expenses").addEventListener("click",(function(t){if("delete"===t.target.id){var n=t.target.closest(".items").parentElement,o=n.id.split("-"),c=o[0],a=Number(o[1]);console.log(t.target,n,o,c,a),i.default.removeItem(c,a),n.remove(),e.updateBudget(),e.updatePercentages()}}))}}]),e}();t.default=u},a6Qp:function(e,t){e.exports=breakpoints},kFay:function(e,t,n){"use strict";n.r(t);var o=n("cDf5"),c=n.n(o),a=(n("OuUZ"),n("E4hX"),n("xVb/")),s=n("SEKM"),i=document.querySelector("body");window.onload=function(){window.setTimeout((function(){i.classList.remove("is-loading")}),100)};var l,u,r,d,p,g;l=a.default,u=document.querySelector(".add__form"),r=document.querySelector(".add__type"),d=document.querySelector(".add__description"),p=document.querySelector(".add__value"),(g=new s.default(r,d,p)).displayDate(),g.changeType(),u.addEventListener("submit",(function(e){e.preventDefault();var t=g.getInput();if(console.log(t),console.log(c()(t.value)),u.reset(),""!==t.desc&&!isNaN(t.value)&&t.value>0){var n=l.addItem(t.type,t.description,t.value);g.render(n,t.type),g.updateBudget(),g.updatePercentages(),console.log("form submitted!"),console.log(n)}})),g.deleteItem()},txRt:function(e,t){e.exports=browser},"xVb/":function(e,t,n){"use strict";n.r(t);var o,c,a,s=n("cDf5"),i=n.n(s),l=n("lwsE"),u=n.n(l),r=n("W8MJ"),d=n.n(r),p=(o=function(){function e(t,n,o){u()(this,e),this.id=t,this.desc=n,this.val=o,this.percentage=-1}return d()(e,[{key:"calcPercentage",value:function(e){this.percentage=e>0?Math.round(this.val/e*100):-1,console.log("this value is ".concat(i()(this.val)),"the totalIncome ".concat(i()(e)))}},{key:"getPercentage",value:function(){return this.percentage}}]),e}(),c={allItems:{exp:[],inc:[]},totals:{exp:0,inc:0},budget:0},a=function(e){var t=0;c.allItems[e].forEach((function(e){t+=e.val})),c.totals[e]=t},{addItem:function(e,t,n){var a=c.allItems[e].length>0?c.allItems[e][c.allItems[e].length-1].id+1:0,s=new o(a,t,n);return c.allItems[e].push(s),s},calculateBudget:function(){return a("exp"),a("inc"),c.budget=c.totals.inc-c.totals.exp,c.totals.inc>0?c.percent=Math.round(c.totals.exp/c.totals.inc*100):c.percent=-1,console.log(c.totals.exp,c.totals.inc),console.log(c.budget,c.percent),c},calculatePercentages:function(){c.allItems.exp.forEach((function(e){e.calcPercentage(c.totals.inc)}))},getPercentages:function(){return c.allItems.exp.map((function(e){return e.getPercentage()}))},removeItem:function(e,t){var n=c.allItems[e].map((function(e){return e.id})).indexOf(t);-1!==n&&c.allItems[e].splice(n,1)}});t.default=p}},[[0,"runtime","vendors"]]]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi93ZWJzaXRlL3NyYy9qcy9tb2R1bGVzL2hlbHBlcnMuanMiLCJ3ZWJwYWNrOi8vLy4vd2Vic2l0ZS9zcmMvanMvbW9kdWxlcy91aWNvbnRyb2xsZXIuanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiYnJlYWtwb2ludHNcIiIsIndlYnBhY2s6Ly8vLi93ZWJzaXRlL3NyYy9qcy9hcHAuanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiYnJvd3NlclwiIiwid2VicGFjazovLy8uL3dlYnNpdGUvc3JjL2pzL21vZHVsZXMvYnVkZ2V0Y29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJtZXRob2QiLCJub29wIiwibWV0aG9kcyIsImxlbmd0aCIsImNvbnNvbGUiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlRmlyc3RUYWIiLCJlIiwia2V5Q29kZSIsImRvY3VtZW50IiwiYm9keSIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJxdWVyeVNlbGVjdG9yIiwic2V0QXR0cmlidXRlIiwiYnJvd3NlciIsIm5hbWUiLCJicmVha3BvaW50cyIsInhsYXJnZSIsImxhcmdlIiwibWVkaXVtIiwic21hbGwiLCJ4c21hbGwiLCJtb2JpbGUiLCJvbiIsInJlbW92ZSIsImxvY2F0aW9uIiwiaG9zdG5hbWUiLCJsb2ciLCJmb3JtYXROdW1iZXIiLCJudW1iZXIiLCJ0eXBlIiwibW9uZXkiLCJjYWxjIiwibnVtIiwiTWF0aCIsImFicyIsIm51bVNwbGl0IiwidG9GaXhlZCIsInNwbGl0IiwiaW50IiwiZGVjaW1hbCIsIk51bWJlciIsInN1YnN0ciIsImN1cnJlbmN5IiwiVUlDb250cm9sbGVyIiwiY29zdCIsImRlc2NyaXB0aW9uIiwidmFsdWUiLCJ0aGlzIiwiaW5wdXRUeXBlIiwiaW5wdXREZXNjIiwiaW5wdXRWYWwiLCJvYmoiLCJodG1sIiwiaXRlbSIsImxpc3QiLCJpZCIsImRlc2MiLCJ2YWwiLCJpbm5lckhUTUwiLCJkYXRhIiwiYnVkZ2V0IiwidG90YWxJbmMiLCJ0b3RhbHMiLCJpbmMiLCJ0b3RhbEV4cCIsImV4cCIsInBlcmNlbnQiLCJ0eXBlcyIsInBlcmNlbnRhZ2UiLCJnZXREYXRhIiwiYnVkZ2V0Q29udHJvbGxlciIsImNhbGN1bGF0ZUJ1ZGdldCIsIm5ld0J1ZGdldCIsImdldEJ1ZGdldCIsImRpc3BsYXlCdWRnZXQiLCJkaXNwbGF5UGVyY2VudGFnZSIsInBlcmNlbnRhZ2VzIiwiY2IiLCJpIiwibm9kZUxpc3RGb3JFYWNoIiwicXVlcnlTZWxlY3RvckFsbCIsImN1cnJlbnQiLCJpbmRleCIsImNhbGN1bGF0ZVBlcmNlbnRhZ2VzIiwiZ2V0UGVyY2VudGFnZXMiLCJkaXNwbGF5UGVyY2VudGFnZXMiLCJidWRnZXREYXRlIiwiZGF0ZSIsIkRhdGUiLCJ0ZXh0Q29udGVudCIsImdldE1vbnRoIiwiZ2V0RnVsbFllYXIiLCJjaGVjayIsImZpZWxkcyIsIm9wdGlvbnMiLCJBcnJheSIsImZyb20iLCJhdHRyaWJ1dGVzIiwic2VsZWN0ZWRJbmRleCIsImZvckVhY2giLCJmaWVsZCIsInRvZ2dsZSIsInJlbW92ZUF0dHJpYnV0ZSIsInRhcmdldCIsImNsb3Nlc3QiLCJwYXJlbnRFbGVtZW50Iiwic3BsaXRJRCIsIklEIiwicmVtb3ZlSXRlbSIsInVwZGF0ZUJ1ZGdldCIsInVwZGF0ZVBlcmNlbnRhZ2VzIiwibW9kdWxlIiwiZXhwb3J0cyIsIm9ubG9hZCIsInNldFRpbWVvdXQiLCJidWRnZXRDdHJsIiwiZm9ybSIsIlVJQ3RybCIsImRpc3BsYXlEYXRlIiwiY2hhbmdlVHlwZSIsInByZXZlbnREZWZhdWx0IiwiaW5wdXQiLCJnZXRJbnB1dCIsInJlc2V0IiwiaXNOYU4iLCJuZXdJdGVtIiwiYWRkSXRlbSIsInJlbmRlciIsImRlbGV0ZUl0ZW0iLCJCdWRnZXQiLCJjYWxjdWxhdGVUb3RhbHMiLCJ0b3RhbEluY29tZSIsInJvdW5kIiwiYWxsSXRlbXMiLCJzdW0iLCJjdXIiLCJwdXNoIiwiY2FsY1BlcmNl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V0FxQmYsT0FuQkEyRCxFQUFnQixPQUNoQkEsRUFBZ0IsT0FHaEJ2RSxFQUFLQyxPQUFTRCxFQUFLRyxPQUFPQyxJQUFNSixFQUFLRyxPQUFPRyxJQUd4Q04sRUFBS0csT0FBT0MsSUFBTSxFQUNwQkosRUFBS08sUUFBVWpDLEtBQUttRyxNQUFPekUsRUFBS0csT0FBT0csSUFBTU4sRUFBS0csT0FBT0MsSUFBTyxLQUVoRUosRUFBS08sU0FBVyxFQUtoQmxFLFFBQVEwQixJQUFJaUMsRUFBS0csT0FBT0csSUFBS04sRUFBS0csT0FBT0MsS0FDekMvRCxRQUFRMEIsSUFBSWlDLEVBQUtDLE9BQVFELEVBQUtPLFNBR3pCUCxHQUVUd0IscUJBQXNCLFdBQ3BCeEIsRUFBSzBFLFNBQVNwRSxJQUFJa0MsU0FBUSxTQUFDb0MsR0FDekJBLEVBQUlFLGVBQWU5RSxFQUFLRyxPQUFPQyxTQUduQ3FCLGVBQWdCLFdBSWQsT0FIZ0J6QixFQUFLMEUsU0FBU3BFLElBQUl5RSxLQUFJLFNBQUNILEdBQ3JDLE9BQU9BLEVBQUlJLG9CQUlmL0IsV0FBWSxTQUFDL0UsRUFBTTBCLEdBQ2pCLElBR00yQixFQUhNdkIsRUFBSzBFLFNBQVN4RyxHQUFNNkcsS0FBSSxTQUFDekQsR0FDbkMsT0FBT0EsRUFBUTFCLE1BRUNxRixRQUFRckYsSUFFWCxJQUFYMkIsR0FDRnZCLEVBQUswRSxTQUFTeEcsR0FBTWdILE9BQU8zRCxFQUFPLE1BTTNCWixjIiwiZmlsZSI6ImFwcC5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby11bmRlZiAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tcGx1c3BsdXMgKi9cbi8qIGVzbGludC1kaXNhYmxlIG5vLW11bHRpLWFzc2lnbiAqL1xuXG4vLyBBdm9pZCBgY29uc29sZWAgZXJyb3JzIGluIGJyb3dzZXJzIHRoYXQgbGFjayBhIGNvbnNvbGUuXG57XG4gIGxldCBtZXRob2RcbiAgY29uc3Qgbm9vcCA9ICgpID0+IHt9XG4gIGNvbnN0IG1ldGhvZHMgPSBbXG4gICAgJ2Fzc2VydCcsXG4gICAgJ2NsZWFyJyxcbiAgICAnY291bnQnLFxuICAgICdkZWJ1ZycsXG4gICAgJ2RpcicsXG4gICAgJ2RpcnhtbCcsXG4gICAgJ2Vycm9yJyxcbiAgICAnZXhjZXB0aW9uJyxcbiAgICAnZ3JvdXAnLFxuICAgICdncm91cENvbGxhcHNlZCcsXG4gICAgJ2dyb3VwRW5kJyxcbiAgICAnaW5mbycsXG4gICAgJ2xvZycsXG4gICAgJ21hcmtUaW1lbGluZScsXG4gICAgJ3Byb2ZpbGUnLFxuICAgICdwcm9maWxlRW5kJyxcbiAgICAndGFibGUnLFxuICAgICd0aW1lJyxcbiAgICAndGltZUVuZCcsXG4gICAgJ3RpbWVsaW5lJyxcbiAgICAndGltZWxpbmVFbmQnLFxuICAgICd0aW1lU3RhbXAnLFxuICAgICd0cmFjZScsXG4gICAgJ3dhcm4nLFxuICBdXG4gIGxldCB7IGxlbmd0aCB9ID0gbWV0aG9kc1xuICBjb25zdCBjb25zb2xlID0gKHdpbmRvdy5jb25zb2xlID0gd2luZG93LmNvbnNvbGUgfHwge30pXG5cbiAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgbWV0aG9kID0gbWV0aG9kc1tsZW5ndGhdXG5cbiAgICAvLyBPbmx5IHN0dWIgdW5kZWZpbmVkIG1ldGhvZHMuXG4gICAgaWYgKCFjb25zb2xlW21ldGhvZF0pIHtcbiAgICAgIGNvbnNvbGVbbWV0aG9kXSA9IG5vb3BcbiAgICB9XG4gIH1cbn1cblxuLy8gQWRkIHRhYmJpbmcgaW5kaWNhdG9yIHRvIHdpbmRvd1xuY29uc3QgaGFuZGxlRmlyc3RUYWIgPSAoZSkgPT4ge1xuICBpZiAoZS5rZXlDb2RlID09PSA5KSB7XG4gICAgLy8gdGhlIFwiSSBhbSBhIGtleWJvYXJkIHVzZXJcIiBrZXlcbiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ3VzZXItaXMtdGFiYmluZycpXG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVGaXJzdFRhYilcbiAgfVxufVxuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUZpcnN0VGFiKVxuXG4vLyBBZGQgYSBicm93ZXIgaW5kaWNhdG9yIHRvIHRoZSBIVE1MIGVsZW1lbnQuXG5jb25zdCBodG1sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaHRtbCcpXG5odG1sLnNldEF0dHJpYnV0ZSgnZGF0YS1icm93c2VyJywgYnJvd3Nlci5uYW1lKVxuXG4vLyBEZXRlY3QgaWYgbW9iaWxlIG9yIGRlc2t0b3AuXG5jb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpXG5cbmJyZWFrcG9pbnRzKHtcbiAgeGxhcmdlOiBbJzEyODFweCcsICcxNjgwcHgnXSxcbiAgbGFyZ2U6IFsnOTgxcHgnLCAnMTI4MHB4J10sXG4gIG1lZGl1bTogWyc3MzdweCcsICc5ODBweCddLFxuICBzbWFsbDogWyc0ODFweCcsICc3MzZweCddLFxuICB4c21hbGw6IFtudWxsLCAnNDgwcHgnXSxcbn0pXG5cbmlmIChicm93c2VyLm1vYmlsZSkge1xuICBib2R5LmNsYXNzTGlzdC5hZGQoJ2lzLW1vYmlsZScpXG59IGVsc2Uge1xuICBicmVha3BvaW50cy5vbignPm1lZGl1bScsICgpID0+IHtcbiAgICBib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2lzLW1vYmlsZScpXG4gICAgYm9keS5jbGFzc0xpc3QuYWRkKCdpcy1kZXNrdG9wJylcbiAgfSlcbiAgYnJlYWtwb2ludHMub24oJzw9bWVkaXVtJywgKCkgPT4ge1xuICAgIGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnaXMtZGVza3RvcCcpXG4gICAgYm9keS5jbGFzc0xpc3QuYWRkKCdpcy1tb2JpbGUnKVxuICB9KVxufVxuXG4vLyBMb2cgaWYgcnVubmluZyBpbiBsb2NhbGhvc3Qgd2hlbiBpbiBkZXZlbG9wbWVudCBtb2RlLlxuaWYgKFxuICB3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUgPT09ICdsb2NhbGhvc3QnICYmXG4gIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbidcbikge1xuICBjb25zb2xlLmxvZygnbG9jYWxob3N0IGRldGVjdGVkIScpXG59XG4iLCIvKiBlc2xpbnQtZGlzYWJsZSBjbGFzcy1tZXRob2RzLXVzZS10aGlzICovXG5pbXBvcnQgYnVkZ2V0Q29udHJvbGxlciBmcm9tICcuL2J1ZGdldGNvbnRyb2xsZXInXG5cbmNvbnN0IGZvcm1hdE51bWJlciA9IChudW1iZXIsIHR5cGUsIG1vbmV5ID0gZmFsc2UsIGNhbGMgPSB0cnVlKSA9PiB7XG4gIC8qKlxuICAgKiArIG9yIC0gYmVmb3JlIHRoZSBudW1iZXJcbiAgICogZXhhY3RseSAyIGRlY2ltYWwgcG9pbnRzXG4gICAqIGNvbW1hIHNlcGVyYXRpbmcgdGhlIHRob3VzYW5kc1xuICAgKlxuICAgKiAyMzEwLjQ1NjcgPSArIDIsMzEwLjQ2XG4gICAqL1xuICBsZXQgbnVtID0gTWF0aC5hYnMobnVtYmVyKVxuICBudW0gPSBudW0udG9GaXhlZCgyKVxuXG4gIGNvbnN0IG51bVNwbGl0ID0gbnVtLnNwbGl0KCcuJykgLy8gbm93IGEgc3RyaW5nIGFuZCB3aWxsIHNwbGl0IHRoZSAuIHRvIHJlcGxhY2Ugd2l0aCBhICxcbiAgbGV0IGludCA9IG51bVNwbGl0WzBdXG4gIGxldCBkZWNpbWFsID0gbnVtU3BsaXRbMV1cbiAgZGVjaW1hbCA9IE51bWJlcihkZWNpbWFsKSA+IDAgPyBgLiR7ZGVjaW1hbH1gIDogJydcblxuICBpZiAoaW50Lmxlbmd0aCA+IDMpIHtcbiAgICAvLyBzdWJzdHIgYWxsb3dzIGZvciBvbmx5IHBhcnQgb2YgdGhlIHN0cmluZyB0byBiZSB0YWtlblxuICAgIGludCA9IGAke2ludC5zdWJzdHIoMCwgaW50Lmxlbmd0aCAtIDMpfSwke2ludC5zdWJzdHIoaW50Lmxlbmd0aCAtIDMsIDMpfWAgLy8gaW5wdXQgMjMxMCwgb3V0cHV0IDIsMzEwXG4gIH1cblxuICBsZXQgc2lnblxuICBpZiAoY2FsYykge1xuICAgIHNpZ24gPVxuICAgICAgdHlwZSA9PT0gJ2V4cCdcbiAgICAgICAgPyAnPHNwYW4gY2xhc3M9XCJzaWduXCI+JiM0NTs8L3NwYW4+ICdcbiAgICAgICAgOiAnPHNwYW4gY2xhc3M9XCJzaWduXCI+JiM0Mzs8L3NwYW4+ICdcbiAgfSBlbHNlIHtcbiAgICBzaWduID0gJydcbiAgfVxuICBjb25zdCBjdXJyZW5jeSA9IG1vbmV5ID8gJzxzcGFuIGNsYXNzPVwiY3VycmVuY3lcIj4mcG91bmQ7PC9zcGFuPicgOiAnJ1xuXG4gIC8vIFJldHVybiB0aGUgZm9ybWF0dGVkIHN0cmluZ1xuICByZXR1cm4gYCR7c2lnbn0ke2N1cnJlbmN5fSR7aW50fSR7ZGVjaW1hbH1gXG59XG5cbi8qIGVzbGludC1kaXNhYmxlIHByZWZlci1kZXN0cnVjdHVyaW5nICovXG5jbGFzcyBVSUNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3Rvcihjb3N0LCBkZXNjcmlwdGlvbiwgdmFsdWUpIHtcbiAgICB0aGlzLmlucHV0VHlwZSA9IGNvc3RcbiAgICB0aGlzLmlucHV0RGVzYyA9IGRlc2NyaXB0aW9uXG4gICAgdGhpcy5pbnB1dFZhbCA9IHZhbHVlXG4gIH1cblxuICBnZXRJbnB1dCgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogdGhpcy5pbnB1dFR5cGUudmFsdWUsIC8vIFdpbGwgYmUgZWl0aGVyIGluYyBvciBleHBcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmlucHV0RGVzYy52YWx1ZSxcbiAgICAgIHZhbHVlOiBOdW1iZXIodGhpcy5pbnB1dFZhbC52YWx1ZSksXG4gICAgfVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXNcbiAgcmVuZGVyKG9iaiwgdHlwZSkge1xuICAgIGNvbnN0IGl0ZW0gPSB0eXBlID09PSAnZXhwJyA/ICdleHBlbnNlcycgOiAnaW5jb21lJ1xuICAgIGNvbnN0IGxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAuJHtpdGVtfV9fbGlzdGApXG4gICAgbGV0IGh0bWxcblxuICAgIC8vIENyZWF0ZSBIVE1MIHN0cmluZyB3aXRoIHBsYWNlaG9sZGVyXG4gICAgaHRtbCA9IGBcbiAgICA8bGkgY2xhc3M9JyR7aXRlbX1fX2l0ZW0nIGlkPScke3R5cGV9LSR7b2JqLmlkfSc+XG4gICAgICA8ZGl2IGNsYXNzPSdpdGVtLWRlc2MnPjxwPiR7b2JqLmRlc2N9PC9wPjwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cIml0ZW1zXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9J2l0ZW1zX192YWx1ZSc+PHA+JHtmb3JtYXROdW1iZXIoXG4gICAgICAgICAgb2JqLnZhbCxcbiAgICAgICAgICB0eXBlLFxuICAgICAgICAgIHRydWUsXG4gICAgICAgICAgZmFsc2VcbiAgICAgICAgKX08L3A+PC9kaXY+XG4gICAgYFxuXG4gICAgaWYgKHR5cGUgPT09ICdleHAnKSB7XG4gICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPVwiaXRlbXNfX3BlcmNlbnRcIj48cD4wJiMzNzs8L3A+PC9kaXY+J1xuICAgIH1cblxuICAgIGh0bWwgKz0gYFxuICAgICAgICA8YnV0dG9uIGNsYXNzPSdidG4gYnRuLS1jbGVhciBpdGVtc19fZGVsJz5cbiAgICAgICAgICA8c3ZnIGlkPVwiZGVsZXRlXCIgY2xhc3M9XCJpY29uXCIgd2lkdGg9XCIyMFwiIGhlaWdodD1cIjIwXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+XG4gICAgICAgICAgICA8dXNlIHhsaW5rOmhyZWY9XCIvYXNzZXRzL2ltYWdlcy9pY29ucy5zdmcjaWNvbi1kZWxldGVcIj48L3VzZT5cbiAgICAgICAgICA8L3N2Zz5cbiAgICAgICAgPC9idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICA8L2xpPlxuICAgIGBcblxuICAgIC8vIEluc2VydCBIVE1MIGludG8gdGhlIERPTVxuICAgIGxpc3QuaW5uZXJIVE1MICs9IGh0bWxcbiAgfVxuXG4gIGdldEJ1ZGdldChkYXRhKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGJ1ZGdldDogZGF0YS5idWRnZXQsXG4gICAgICB0b3RhbEluYzogZGF0YS50b3RhbHMuaW5jLFxuICAgICAgdG90YWxFeHA6IGRhdGEudG90YWxzLmV4cCxcbiAgICAgIHBlcmNlbnQ6IGRhdGEucGVyY2VudCxcbiAgICB9XG4gIH1cblxuICBkaXNwbGF5QnVkZ2V0KG9iaikge1xuICAgIGNvbnN0IHR5cGUgPSBvYmouYnVkZ2V0ID4gMCA/ICdpbmMnIDogJ2V4cCdcbiAgICBjb25zdCB0eXBlcyA9IHR5cGUgPT09ICdleHAnID8gJ2V4cGVuc2VzJyA6ICdpbmNvbWUnXG4gICAgY29uc3QgYnVkZ2V0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ1ZGdldF9fdmFsdWUnKVxuICAgIGNvbnN0IGluYyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5idWRnZXRfX2luY29tZSAuYnVkZ2V0X19hbW91bnRgKVxuICAgIGNvbnN0IGV4cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5idWRnZXRfX2V4cGVuc2VzIC5idWRnZXRfX2Ftb3VudGApXG5cbiAgICBidWRnZXQuaW5uZXJIVE1MID0gZm9ybWF0TnVtYmVyKG9iai5idWRnZXQsIHR5cGUsIHRydWUpXG4gICAgaW5jLmlubmVySFRNTCA9IGZvcm1hdE51bWJlcihvYmoudG90YWxJbmMsICdpbmMnKVxuICAgIGV4cC5pbm5lckhUTUwgPSBmb3JtYXROdW1iZXIob2JqLnRvdGFsRXhwLCAnZXhwJylcblxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICBjb25zb2xlLmxvZyhgVGhlICR7dHlwZXN9IGlzL2FyZSAke29iai5idWRnZXR9YClcbiAgICAgIGNvbnNvbGUubG9nKGluYywgZXhwKVxuICAgIH1cbiAgfVxuXG4gIGRpc3BsYXlQZXJjZW50YWdlKHBlcmNlbnRhZ2UpIHtcbiAgICBjb25zdCBwZXJjZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBlcmNlbnRhZ2UnKVxuXG4gICAgaWYgKHBlcmNlbnRhZ2UgPiAwKSB7XG4gICAgICBwZXJjZW50LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKVxuICAgICAgcGVyY2VudC5pbm5lckhUTUwgPSBgJHtwZXJjZW50YWdlfSYjMzc7YFxuICAgIH0gZWxzZSB7XG4gICAgICBwZXJjZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKVxuICAgIH1cblxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICBjb25zb2xlLmxvZyhwZXJjZW50KVxuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZUJ1ZGdldCgpIHtcbiAgICAvLyAxLiBDaGVjayBsb2NhbFN0b3JhZ2UgZm9yIHNhdmUgYnVkZ2V0IGRhdGEsIGVsc2UgZ2V0IG5ldyBkYXRhXG4gICAgY29uc3QgZ2V0RGF0YSA9IGJ1ZGdldENvbnRyb2xsZXIuY2FsY3VsYXRlQnVkZ2V0KClcblxuICAgIC8vIDIuIFJldHVybiB0aGUgYnVkZ2V0XG4gICAgY29uc3QgbmV3QnVkZ2V0ID0gdGhpcy5nZXRCdWRnZXQoZ2V0RGF0YSlcblxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICBjb25zb2xlLmxvZyhuZXdCdWRnZXQpXG4gICAgfVxuXG4gICAgLy8gMy4gRGlzcGxheSB0aGUgdXBkYXRlZCBidWRnZXRcbiAgICB0aGlzLmRpc3BsYXlCdWRnZXQobmV3QnVkZ2V0KVxuXG4gICAgLy8gNC4gRGlzcGxheSB0aGUgbmV3IG92ZXJhbGwgYnVkZ2V0IHBlcmNlbnRhZ2VcbiAgICB0aGlzLmRpc3BsYXlQZXJjZW50YWdlKG5ld0J1ZGdldC5wZXJjZW50KVxuICB9XG5cbiAgZGlzcGxheVBlcmNlbnRhZ2VzKHBlcmNlbnRhZ2VzKSB7XG4gICAgY29uc3QgZmllbGRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLml0ZW1zX19wZXJjZW50JylcbiAgICBjb25zdCBub2RlTGlzdEZvckVhY2ggPSAobGlzdCwgY2IpID0+IHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICBjYihsaXN0W2ldLCBpKVxuICAgICAgfVxuICAgIH1cbiAgICBub2RlTGlzdEZvckVhY2goZmllbGRzLCAoY3VycmVudCwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChwZXJjZW50YWdlc1tpbmRleF0gPiAwKSB7XG4gICAgICAgIGN1cnJlbnQuY2xhc3NMaXN0LmFkZCgnc2hvdycpXG4gICAgICAgIGN1cnJlbnQuaW5uZXJIVE1MID0gYCR7cGVyY2VudGFnZXNbaW5kZXhdfSYjMzc7YFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3VycmVudC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93JylcbiAgICAgICAgY3VycmVudC5pbm5lckhUTUwgPSAnMCYjMzc7J1xuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICB1cGRhdGVQZXJjZW50YWdlcygpIHtcbiAgICAvLyAxLiBDYWx1bGF0ZSBwZXJjZW50YWdlc1xuICAgIGJ1ZGdldENvbnRyb2xsZXIuY2FsY3VsYXRlUGVyY2VudGFnZXMoKVxuXG4gICAgLy8gMi4gUmVhZCBwZXJjZW50YWdlcyBmcm9tIGJ1ZGdldCBjb250cm9sbGVyXG4gICAgY29uc3QgcGVyY2VudGFnZXMgPSBidWRnZXRDb250cm9sbGVyLmdldFBlcmNlbnRhZ2VzKClcblxuICAgIC8vIDMuIFVwZGF0ZSBVSSB0byBzaG93IG5ldyBwZXJjZW50YWdlc1xuICAgIHRoaXMuZGlzcGxheVBlcmNlbnRhZ2VzKHBlcmNlbnRhZ2VzKVxuICB9XG5cbiAgZGlzcGxheURhdGUoKSB7XG4gICAgY29uc3QgYnVkZ2V0RGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idWRnZXRfX2RhdGUnKVxuICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSgpXG4gICAgY29uc3QgbW9udGhzID0gW1xuICAgICAgJ0phbnVhcnknLFxuICAgICAgJ0ZlYnJ1YXJ5JyxcbiAgICAgICdNYXJjaCcsXG4gICAgICAnQXByaWwnLFxuICAgICAgJ01heScsXG4gICAgICAnSnVuZScsXG4gICAgICAnSnVseScsXG4gICAgICAnQXVndXN0JyxcbiAgICAgICdTZXBldGVtYmVyJyxcbiAgICAgICdPY3RvYmVyJyxcbiAgICAgICdOb3ZlbWJlcicsXG4gICAgICAnRGVjZW1iZXInLFxuICAgIF1cbiAgICBidWRnZXREYXRlLnRleHRDb250ZW50ID0gYCR7bW9udGhzW2RhdGUuZ2V0TW9udGgoKV19ICR7ZGF0ZS5nZXRGdWxsWWVhcigpfWBcbiAgfVxuXG4gIGNoYW5nZVR5cGUoKSB7XG4gICAgY29uc3QgdHlwZSA9IHRoaXMuaW5wdXRUeXBlXG4gICAgY29uc3QgY2hlY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjY2hlY2snKVxuICAgIGNvbnN0IGZpZWxkcyA9IFt0eXBlLCB0aGlzLmlucHV0RGVzYywgdGhpcy5pbnB1dFZhbCwgY2hlY2tdXG5cbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgY29uc29sZS5sb2coZmllbGRzKVxuICAgIH1cblxuICAgIHR5cGUuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSBBcnJheS5mcm9tKHR5cGUub3B0aW9ucylcblxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgICAgICAgY29uc29sZS5sb2coZSlcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgdHlwZS5hdHRyaWJ1dGVzLFxuICAgICAgICAgIHR5cGUub3B0aW9ucyxcbiAgICAgICAgICB0eXBlLm9wdGlvbnMuc2VsZWN0ZWRJbmRleCxcbiAgICAgICAgICBvcHRpb25zLFxuICAgICAgICAgIG9wdGlvbnNbMV1cbiAgICAgICAgKVxuICAgICAgfVxuXG4gICAgICBmaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgZmllbGQuY2xhc3NMaXN0LnRvZ2dsZSgnZXhwJylcbiAgICAgIH0pXG4gICAgICBpZiAodHlwZS5vcHRpb25zLnNlbGVjdGVkSW5kZXggPT09IDEpIHtcbiAgICAgICAgb3B0aW9uc1swXS5yZW1vdmVBdHRyaWJ1dGUoJ3NlbGVjdGVkJywgJ3NlbGVjdGVkJylcbiAgICAgICAgb3B0aW9uc1sxXS5zZXRBdHRyaWJ1dGUoJ3NlbGVjdGVkJywgJ3NlbGVjdGVkJylcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9wdGlvbnNbMV0ucmVtb3ZlQXR0cmlidXRlKCdzZWxlY3RlZCcsICdzZWxlY3RlZCcpXG4gICAgICAgIG9wdGlvbnNbMF0uc2V0QXR0cmlidXRlKCdzZWxlY3RlZCcsICdzZWxlY3RlZCcpXG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGRlbGV0ZUl0ZW0oKSB7XG4gICAgY29uc3QgaXRlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbmNvbWUtZXhwZW5zZXMnKVxuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgaWYgKGUudGFyZ2V0LmlkID09PSAnZGVsZXRlJykge1xuICAgICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldC5jbG9zZXN0KCcuaXRlbXMnKS5wYXJlbnRFbGVtZW50XG4gICAgICAgIGNvbnN0IHNwbGl0SUQgPSB0YXJnZXQuaWQuc3BsaXQoJy0nKVxuICAgICAgICBjb25zdCB0eXBlID0gc3BsaXRJRFswXVxuICAgICAgICBjb25zdCBJRCA9IE51bWJlcihzcGxpdElEWzFdKVxuXG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZS50YXJnZXQsIHRhcmdldCwgc3BsaXRJRCwgdHlwZSwgSUQpXG4gICAgICAgIH1cblxuICAgICAgICAvLyAxLiBEZWxldGUgdGhlIGl0ZW0gZnJvbSB0aGUgZGF0YSBzdHJ1Y3R1cmVcbiAgICAgICAgYnVkZ2V0Q29udHJvbGxlci5yZW1vdmVJdGVtKHR5cGUsIElEKVxuXG4gICAgICAgIC8vIDIuIERlbGV0ZSB0aGUgaXRlbSBmcm9tIHRoZSBVSVxuICAgICAgICB0YXJnZXQucmVtb3ZlKClcblxuICAgICAgICAvLyAzLiBVcGRhdGUgYW5kIHNob3cgdGhlIG5ldyBidWRnZXRcbiAgICAgICAgdGhpcy51cGRhdGVCdWRnZXQoKVxuXG4gICAgICAgIC8vIDQuIFVwZGF0ZSBhbmQgc2hvdyB0aGUgbmV3IHBlcmNlbnRhZ2VzXG4gICAgICAgIHRoaXMudXBkYXRlUGVyY2VudGFnZXMoKVxuICAgICAgfVxuICAgIH0pXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVUlDb250cm9sbGVyXG4iLCJtb2R1bGUuZXhwb3J0cyA9IGJyZWFrcG9pbnRzOyIsIi8qIGVzbGludC1kaXNhYmxlIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscyAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tdW5kZWYgKi9cblxuLy8gRXh0ZXJuYWxcbmltcG9ydCAnYWlyYm5iLWJyb3dzZXItc2hpbXMnXG5cbi8vIEludGVybmFsXG5pbXBvcnQgJy4vbW9kdWxlcy9oZWxwZXJzJ1xuaW1wb3J0IGJ1ZGdldENvbnRyb2xsZXIgZnJvbSAnLi9tb2R1bGVzL2J1ZGdldGNvbnRyb2xsZXInXG5pbXBvcnQgVUlDb250cm9sbGVyIGZyb20gJy4vbW9kdWxlcy91aWNvbnRyb2xsZXInXG5cbi8vIFJlbW92ZSBsb2FkaW5nIGNsYXNzIGZyb20gYm9keSBvbiB3aW5kb3cgbG9hZC5cbmNvbnN0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jylcblxud2luZG93Lm9ubG9hZCA9ICgpID0+IHtcbiAgd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgIGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnaXMtbG9hZGluZycpXG4gIH0sIDEwMClcbn1cblxuLy8gQ3JlYXRlIHRoZSBtYWluIGNvbnRyb2xsZXIgZm9yIHRoZSBhcHBcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuY29uc3QgY29udHJvbGxlciA9ICgoYnVkZ2V0Q3RybCkgPT4ge1xuICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFkZF9fZm9ybScpXG4gIGNvbnN0IHR5cGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWRkX190eXBlJylcbiAgY29uc3QgZGVzYyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZGRfX2Rlc2NyaXB0aW9uJylcbiAgY29uc3QgdmFsdWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWRkX192YWx1ZScpXG5cbiAgY29uc3QgVUlDdHJsID0gbmV3IFVJQ29udHJvbGxlcih0eXBlLCBkZXNjLCB2YWx1ZSlcblxuICAvLyBTaG9lIHRoZSBsYXRlc3QgZGF0ZVxuICBVSUN0cmwuZGlzcGxheURhdGUoKVxuXG4gIC8vIFRvZ2dsZSB0aGUgc3VibWl0IG5ldyBjb3N0IGZyb20gZWl0aGVyIGluY29tZSBvciBleHBlbnNlLlxuICBVSUN0cmwuY2hhbmdlVHlwZSgpXG5cbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4ge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuXG4gICAgLy8gR2V0IGZpbGVkIGlucHV0IGRhdGFcbiAgICBjb25zdCBpbnB1dCA9IFVJQ3RybC5nZXRJbnB1dCgpXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgICAgIGNvbnNvbGUubG9nKGlucHV0KVxuICAgICAgY29uc29sZS5sb2codHlwZW9mIGlucHV0LnZhbHVlKVxuICAgIH1cblxuICAgIC8vIENsZWFyIHRoZSBmb3JtIGZpZWxkc1xuICAgIGZvcm0ucmVzZXQoKVxuXG4gICAgLy8gT25seSBydW4gY2FsY3VsYXRpb25zIGlmIHZhbGlkIGlucHV0cyBhcmUgZW50ZXJlZFxuICAgIGlmIChpbnB1dC5kZXNjICE9PSAnJyAmJiAhaXNOYU4oaW5wdXQudmFsdWUpICYmIGlucHV0LnZhbHVlID4gMCkge1xuICAgICAgLy8gQWRkIHRoZSBpdGVtIHRvIHRoZSBidWRnZXRcbiAgICAgIGNvbnN0IG5ld0l0ZW0gPSBidWRnZXRDdHJsLmFkZEl0ZW0oXG4gICAgICAgIGlucHV0LnR5cGUsXG4gICAgICAgIGlucHV0LmRlc2NyaXB0aW9uLFxuICAgICAgICBpbnB1dC52YWx1ZVxuICAgICAgKVxuXG4gICAgICAvLyBDYWxjdWxhZSB0aGUgYnVkZ2V0IGFuZCB1cGRhdGUgdGhlIFVJXG4gICAgICBVSUN0cmwucmVuZGVyKG5ld0l0ZW0sIGlucHV0LnR5cGUpIC8vIEFkZCBpdGVtcyB0byBpbmNvbWUgb3IgZXhwZW5zZXMgbGlzdFxuICAgICAgVUlDdHJsLnVwZGF0ZUJ1ZGdldCgpIC8vIE91dHB1dCB0aGUgbmV3IGJ1ZGdldFxuICAgICAgVUlDdHJsLnVwZGF0ZVBlcmNlbnRhZ2VzKCkgLy8gT3V0cHV0IHRoZSBuZXcgcGVyY2VudGFnZXNcblxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2Zvcm0gc3VibWl0dGVkIScpXG4gICAgICAgIGNvbnNvbGUubG9nKG5ld0l0ZW0pXG4gICAgICB9XG4gICAgfVxuICB9KVxuXG4gIC8vIERlbGV0ZSBhbiBhZGRlZCBpbmNvbWUgb3IgZXhwZW5zZVxuICBVSUN0cmwuZGVsZXRlSXRlbSgpXG59KShidWRnZXRDb250cm9sbGVyKVxuIiwibW9kdWxlLmV4cG9ydHMgPSBicm93c2VyOyIsImNvbnN0IGJ1ZGdldENvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICBjbGFzcyBCdWRnZXQge1xuICAgIGNvbnN0cnVjdG9yKGlkLCBkZXNjcmlwdGlvbiwgdmFsdWUpIHtcbiAgICAgIHRoaXMuaWQgPSBpZFxuICAgICAgdGhpcy5kZXNjID0gZGVzY3JpcHRpb25cbiAgICAgIHRoaXMudmFsID0gdmFsdWVcbiAgICAgIHRoaXMucGVyY2VudGFnZSA9IC0xXG4gICAgfVxuXG4gICAgY2FsY1BlcmNlbnRhZ2UodG90YWxJbmNvbWUpIHtcbiAgICAgIGlmICh0b3RhbEluY29tZSA+IDApIHtcbiAgICAgICAgdGhpcy5wZXJjZW50YWdlID0gTWF0aC5yb3VuZCgodGhpcy52YWwgLyB0b3RhbEluY29tZSkgKiAxMDApXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnBlcmNlbnRhZ2UgPSAtMVxuICAgICAgfVxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYHRoaXMgdmFsdWUgaXMgJHt0eXBlb2YgdGhpcy52YWx9YCxcbiAgICAgICAgICBgdGhlIHRvdGFsSW5jb21lICR7dHlwZW9mIHRvdGFsSW5jb21lfWBcbiAgICAgICAgKVxuICAgICAgfVxuICAgIH1cblxuICAgIGdldFBlcmNlbnRhZ2UoKSB7XG4gICAgICByZXR1cm4gdGhpcy5wZXJjZW50YWdlXG4gICAgfVxuICB9XG5cbiAgY29uc3QgZGF0YSA9IHtcbiAgICBhbGxJdGVtczoge1xuICAgICAgZXhwOiBbXSxcbiAgICAgIGluYzogW10sXG4gICAgfSxcbiAgICB0b3RhbHM6IHtcbiAgICAgIGV4cDogMCxcbiAgICAgIGluYzogMCxcbiAgICB9LFxuICAgIGJ1ZGdldDogMCxcbiAgfVxuXG4gIGNvbnN0IGNhbGN1bGF0ZVRvdGFscyA9ICh0eXBlKSA9PiB7XG4gICAgbGV0IHN1bSA9IDBcbiAgICBkYXRhLmFsbEl0ZW1zW3R5cGVdLmZvckVhY2goKGN1cikgPT4ge1xuICAgICAgc3VtICs9IGN1ci52YWxcbiAgICB9KVxuICAgIGRhdGEudG90YWxzW3R5cGVdID0gc3VtXG4gIH1cblxuICByZXR1cm4ge1xuICAgIGFkZEl0ZW06ICh0eXBlLCBkZXNjLCB2YWwpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBuZXcgSURcbiAgICAgIGNvbnN0IElEID1cbiAgICAgICAgZGF0YS5hbGxJdGVtc1t0eXBlXS5sZW5ndGggPiAwXG4gICAgICAgICAgPyBkYXRhLmFsbEl0ZW1zW3R5cGVdW2RhdGEuYWxsSXRlbXNbdHlwZV0ubGVuZ3RoIC0gMV0uaWQgKyAxXG4gICAgICAgICAgOiAwXG5cbiAgICAgIC8vIFNldCBuZXcgaXRlbSB0byB1c2Ugb2JqZWN0XG4gICAgICBjb25zdCBuZXdJdGVtID0gbmV3IEJ1ZGdldChJRCwgZGVzYywgdmFsKVxuXG4gICAgICAvLyBQdXNoIGl0IGludG8gZGF0YSBzdHJ1Y3R1cmVcbiAgICAgIGRhdGEuYWxsSXRlbXNbdHlwZV0ucHVzaChuZXdJdGVtKVxuXG4gICAgICAvLyBjcmVhdGUgbmV3IGl0ZW1cbiAgICAgIHJldHVybiBuZXdJdGVtXG4gICAgfSxcbiAgICBjYWxjdWxhdGVCdWRnZXQ6ICgpID0+IHtcbiAgICAgIC8vIDEuIENhbGN1bGF0ZSB0aGUgYnVkZ2V0XG4gICAgICBjYWxjdWxhdGVUb3RhbHMoJ2V4cCcpXG4gICAgICBjYWxjdWxhdGVUb3RhbHMoJ2luYycpXG5cbiAgICAgIC8vIDIuIENhbGN1bGF0ZSB0aGUgYnVkZ2V0OiBpbmNvbWUgLSBleHBlbnNlc1xuICAgICAgZGF0YS5idWRnZXQgPSBkYXRhLnRvdGFscy5pbmMgLSBkYXRhLnRvdGFscy5leHBcblxuICAgICAgLy8gMy4gQ2FsY3VsYXRlIHRoZSBwZXJjZW50YWdlIG9mIGluY29tZSB0aGF0IHdlIHNwZW50XG4gICAgICBpZiAoZGF0YS50b3RhbHMuaW5jID4gMCkge1xuICAgICAgICBkYXRhLnBlcmNlbnQgPSBNYXRoLnJvdW5kKChkYXRhLnRvdGFscy5leHAgLyBkYXRhLnRvdGFscy5pbmMpICogMTAwKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGF0YS5wZXJjZW50ID0gLTFcbiAgICAgIH1cblxuICAgICAgLy8gMy4gUmV0dXJuIHRoZSBidWRnZXRcbiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEudG90YWxzLmV4cCwgZGF0YS50b3RhbHMuaW5jKVxuICAgICAgICBjb25zb2xlLmxvZyhkYXRhLmJ1ZGdldCwgZGF0YS5wZXJjZW50KVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGF0YVxuICAgIH0sXG4gICAgY2FsY3VsYXRlUGVyY2VudGFnZXM6ICgpID0+IHtcbiAgICAgIGRhdGEuYWxsSXRlbXMuZXhwLmZvckVhY2goKGN1cikgPT4ge1xuICAgICAgICBjdXIuY2FsY1BlcmNlbnRhZ2UoZGF0YS50b3RhbHMuaW5jKVxuICAgICAgfSlcbiAgICB9LFxuICAgIGdldFBlcmNlbnRhZ2VzOiAoKSA9PiB7XG4gICAgICBjb25zdCBhbGxQZXJjID0gZGF0YS5hbGxJdGVtcy5leHAubWFwKChjdXIpID0+IHtcbiAgICAgICAgcmV0dXJuIGN1ci5nZXRQZXJjZW50YWdlKClcbiAgICAgIH0pXG4gICAgICByZXR1cm4gYWxsUGVyY1xuICAgIH0sXG4gICAgcmVtb3ZlSXRlbTogKHR5cGUsIGlkKSA9PiB7XG4gICAgICBjb25zdCBpZHMgPSBkYXRhLmFsbEl0ZW1zW3R5cGVdLm1hcCgoY3VycmVudCkgPT4ge1xuICAgICAgICByZXR1cm4gY3VycmVudC5pZFxuICAgICAgfSlcbiAgICAgIGNvbnN0IGluZGV4ID0gaWRzLmluZGV4T2YoaWQpXG5cbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgZGF0YS5hbGxJdGVtc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpXG4gICAgICB9XG4gICAgfSxcbiAgfVxufSkoKVxuXG5leHBvcnQgZGVmYXVsdCBidWRnZXRDb250cm9sbGVyXG4iXSwic291cmNlUm9vdCI6IiJ9